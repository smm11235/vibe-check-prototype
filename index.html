<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Vibe Check</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Silkscreen:wght@700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ── Font Mapping ──
   NeueBit-Bold       → Silkscreen 700 (pixel/retro display)
   RightGrotesk-*Bold → Space Grotesk 700 (compact headlines/CTAs)
   RightGrotesk-Med   → Space Grotesk 500 (UI labels)
   RightGrotesk-Reg   → Space Grotesk 400 (body)
── */

/* ── CSS Variables ── */
:root {
    --bg-primary: #0A0A0A;
    --bg-surface: #151515;
    --bg-card: #1E1E1E;
    --bg-elevated: #2A2A2A;
    --accent-primary: #FFD60A;
    --accent-secondary: #B8FF3C;
    --text-primary: #FFFFFF;
    --text-secondary: #A0A0A0;
    --text-tertiary: #666666;
    --text-disabled: #444444;
    --pulse: #EC4899;
    --glow: #22C55E;
    --cozy: #F97316;
    --lore: #3B82F6;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
}

/* ── Reset ── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
    height: 100%;
    overflow: hidden;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
    -webkit-font-smoothing: antialiased;
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
}

/* ── Shared ── */
.screen {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: calc(var(--safe-top) + 12px) 24px calc(var(--safe-bottom) + 24px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
}
.screen.active { opacity: 1; pointer-events: auto; }

.btn-primary {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    background: var(--accent-primary);
    color: var(--bg-primary);
    border: none;
    border-radius: 999px;
    padding: 0 32px;
    height: 48px;
    font-size: 17px;
    font-weight: 700;
    letter-spacing: 0.02em;
    cursor: pointer;
    -webkit-appearance: none;
    transition: transform 0.15s ease, opacity 0.15s ease;
}
.btn-primary:active { transform: scale(0.96); opacity: 0.9; }

.btn-ghost {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    background: none;
    border: none;
    color: var(--text-tertiary);
    font-size: 14px;
    cursor: pointer;
    padding: 12px;
}

/* ── Landing ── */
#landing { z-index: 10; }
.orbs-container {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
}
.orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.12;
    animation: orbFloat 8s ease-in-out infinite;
}
.orb.pulse-orb { background: var(--pulse); width: 200px; height: 200px; top: 15%; left: -5%; animation-delay: 0s; }
.orb.glow-orb { background: var(--glow); width: 180px; height: 180px; top: 10%; right: -10%; animation-delay: -2s; }
.orb.cozy-orb { background: var(--cozy); width: 220px; height: 220px; bottom: 20%; left: 10%; animation-delay: -4s; }
.orb.lore-orb { background: var(--lore); width: 190px; height: 190px; bottom: 15%; right: -5%; animation-delay: -6s; }

@keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(20px, -30px) scale(1.1); }
    50% { transform: translate(-15px, 15px) scale(0.95); }
    75% { transform: translate(25px, 20px) scale(1.05); }
}

.landing-content {
    position: relative;
    z-index: 1;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
}
.landing-content h1 {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    color: var(--accent-primary);
    font-size: 32px;
    font-weight: 700;
    line-height: 1.1;
}
.landing-content p {
    color: var(--text-secondary);
    font-size: 16px;
    line-height: 1.4;
    max-width: 280px;
}
.landing-content .btn-primary { margin-top: 16px; }

/* ── Progress Bar ── */
.progress-area {
    position: fixed;
    top: var(--safe-top);
    left: 0;
    right: 0;
    z-index: 100;
    padding: 8px 16px 0;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
}
.progress-area.visible { opacity: 1; }
.progress-pct {
    text-align: right;
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 11px;
    color: var(--text-tertiary);
    margin-bottom: 3px;
}
.progress-track {
    width: 100%;
    height: 4px;
    background: var(--bg-elevated);
    border-radius: 2px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    width: 0%;
    border-radius: 2px;
    background: linear-gradient(90deg, var(--pulse), var(--glow), var(--cozy), var(--lore));
    transition: width 0.4s ease-in-out;
}

/* ── Card Area ── */
#game { z-index: 5; padding-top: calc(var(--safe-top) + 40px); justify-content: flex-start; }

.card-stack {
    position: relative;
    width: 85%;
    max-width: 360px;
    aspect-ratio: 3 / 4.2;
    margin-top: 24px;
}

.quiz-card {
    position: absolute;
    inset: 0;
    background: var(--bg-card);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 32px 24px;
    will-change: transform, opacity;
    touch-action: none;
}

.card-question {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 19px;
    color: var(--text-primary);
    text-align: center;
    line-height: 1.35;
    margin-bottom: 28px;
    flex-shrink: 0;
}

.card-divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 28px;
    width: 100%;
    flex-shrink: 0;
}
.card-divider .line { flex: 1; height: 1px; background: var(--bg-elevated); }
.card-divider .vs {
    font-family: 'Silkscreen', 'Courier New', monospace;
    font-size: 14px;
    color: var(--accent-primary);
    background: rgba(255, 214, 10, 0.1);
    padding: 4px 10px;
    border-radius: 8px;
    letter-spacing: 0.05em;
}

.card-options {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    width: 100%;
    gap: 20px;
}
.card-option {
    flex: 1;
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 15px;
    color: var(--text-secondary);
    line-height: 1.35;
}
.card-option.left { text-align: left; }
.card-option.right { text-align: right; }

/* Swipe indicators */
.swipe-indicator {
    position: absolute;
    top: 16px;
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 14px;
    padding: 6px 14px;
    border-radius: 999px;
    opacity: 0;
    transition: opacity 0.15s ease;
    pointer-events: none;
}
.swipe-indicator.left-ind { left: 16px; border: 2px solid var(--pulse); color: var(--pulse); }
.swipe-indicator.right-ind { right: 16px; border: 2px solid var(--glow); color: var(--glow); }
.swipe-indicator.skip-ind {
    top: auto; bottom: -44px; left: 50%; transform: translateX(-50%);
    border: 2px solid var(--text-tertiary); color: var(--text-tertiary);
}

.swipe-hints {
    margin-top: 28px;
    display: flex;
    justify-content: center;
    gap: 24px;
    opacity: 0.4;
}
.swipe-hint {
    font-size: 12px;
    color: var(--text-tertiary);
    display: flex;
    align-items: center;
    gap: 4px;
}

/* Tutorial */
.tutorial-content {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}
.tutorial-content h2 {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 26px;
    color: var(--accent-primary);
}
.tutorial-hints { display: flex; flex-direction: column; gap: 14px; width: 100%; }
.tutorial-hint {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 15px;
    color: var(--text-secondary);
}
.tutorial-hint .arrow {
    font-family: 'Silkscreen', monospace;
    font-size: 20px;
    color: var(--accent-primary);
    width: 32px;
    text-align: center;
}
.tutorial-footer { font-size: 13px; color: var(--text-tertiary); font-style: italic; margin-top: 4px; }

/* ── Reveal Screen ── */
#reveal { z-index: 15; overflow: hidden; }
.reveal-particles { position: absolute; inset: 0; pointer-events: none; }
.reveal-center {
    position: relative; z-index: 1; text-align: center;
    display: flex; flex-direction: column; align-items: center; gap: 12px;
}
.reveal-emoji { font-size: 56px; opacity: 0; }
.reveal-name { font-family: 'Silkscreen', 'Courier New', monospace; font-size: 48px; line-height: 1.1; opacity: 0; }
.reveal-hangout { font-size: 16px; color: var(--text-secondary); opacity: 0; }
.reveal-tagline { font-family: 'Space Grotesk', -apple-system, sans-serif; font-size: 18px; color: var(--text-secondary); opacity: 0; margin-top: 4px; }
.reveal-btn { opacity: 0; margin-top: 24px; }

.confetti-piece { position: absolute; width: 6px; height: 10px; border-radius: 2px; opacity: 0; }

/* ── Results Screen ── */
#results {
    z-index: 20; overflow-y: auto; -webkit-overflow-scrolling: touch;
    justify-content: flex-start;
    padding-top: calc(var(--safe-top) + 24px);
    padding-bottom: calc(var(--safe-bottom) + 32px);
}
.results-inner { width: 100%; max-width: 390px; display: flex; flex-direction: column; gap: 20px; }

.archetype-card {
    background: var(--bg-card); border-radius: 16px; padding: 20px;
    position: relative; overflow: hidden;
}
.archetype-card::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
    background: var(--card-color);
}
.archetype-badge {
    display: inline-block;
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em;
    padding: 4px 10px; border-radius: 6px; margin-bottom: 10px;
}
.archetype-badge.primary-badge { background: rgba(255, 214, 10, 0.15); color: var(--accent-primary); }
.archetype-badge.secondary-badge { background: rgba(160, 160, 160, 0.15); color: var(--text-secondary); }
.archetype-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.archetype-header .emoji { font-size: 24px; }
.archetype-header .name { font-family: 'Silkscreen', 'Courier New', monospace; font-size: 26px; }
.archetype-desc { font-size: 14px; color: var(--text-secondary); line-height: 1.45; }

/* DNA Bars */
.section-title {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 18px; color: var(--text-primary); margin-bottom: 4px;
}
.section-subtitle { font-size: 13px; color: var(--text-tertiary); margin-bottom: 16px; }

.dna-bars { display: flex; flex-direction: column; gap: 14px; }
.dna-bar-row { display: flex; align-items: center; gap: 10px; }
.dna-label {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 13px; color: var(--text-secondary); min-width: 100px;
    display: flex; align-items: center; gap: 6px;
}
.dna-track { flex: 1; height: 10px; background: var(--bg-elevated); border-radius: 5px; overflow: hidden; }
.dna-fill { height: 100%; border-radius: 5px; width: 0%; transition: width 0.8s cubic-bezier(0, 0, 0.2, 1); }
.dna-pct {
    font-family: 'Silkscreen', 'Courier New', monospace;
    font-size: 16px; min-width: 36px; text-align: right;
}

/* Karma */
.karma-section { background: var(--bg-card); border-radius: 16px; padding: 20px; }
.karma-total { font-family: 'Silkscreen', monospace; font-size: 24px; color: var(--accent-primary); margin-bottom: 14px; }
.karma-rows { display: flex; flex-direction: column; gap: 10px; }
.karma-row { display: flex; justify-content: space-between; align-items: center; font-size: 13px; color: var(--text-secondary); }
.karma-row .amount { font-family: 'Silkscreen', monospace; font-size: 15px; }
.karma-bonus {
    margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--bg-elevated);
    font-size: 13px; color: var(--accent-primary);
}

.results-cta { margin-top: 8px; width: 100%; display: flex; justify-content: center; }

/* ── Profile Prompt Screen ── */
#prompt-screen {
    z-index: 25; overflow-y: auto; -webkit-overflow-scrolling: touch;
    justify-content: flex-start;
    padding-top: calc(var(--safe-top) + 24px);
}
.prompt-inner { width: 100%; max-width: 390px; display: flex; flex-direction: column; gap: 16px; }
.prompt-title {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 24px; color: var(--accent-primary); font-weight: 700;
}
.prompt-subtitle { font-size: 14px; color: var(--text-secondary); margin-top: -8px; }

/* Photo upload area */
.photo-upload-area {
    width: 100%;
    aspect-ratio: 4 / 3;
    max-height: 260px;
    border-radius: 16px;
    border: 2px dashed var(--bg-elevated);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    background: var(--bg-surface);
}
.photo-upload-area:active { transform: scale(0.98); }
.photo-upload-area.has-photo {
    border-style: solid;
    border-color: var(--accent-primary);
    background: linear-gradient(135deg, rgba(236,72,153,0.08), rgba(34,197,94,0.08), rgba(249,115,22,0.08), rgba(59,130,246,0.08));
}
.photo-icon { font-size: 40px; }
.photo-label {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 16px; color: var(--text-primary);
}
.photo-sublabel { font-size: 13px; color: var(--text-tertiary); }
.photo-bonus {
    font-family: 'Silkscreen', monospace;
    font-size: 14px; color: var(--accent-primary);
    background: rgba(255, 214, 10, 0.1);
    padding: 3px 10px; border-radius: 6px; margin-top: 4px;
}
.photo-done-check {
    font-size: 32px;
    animation: lvlPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* Prompt filter & list */
.prompt-filter { display: flex; gap: 8px; flex-wrap: wrap; }
.filter-chip {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 13px; padding: 8px 14px; border-radius: 999px;
    border: 1.5px solid var(--bg-elevated); background: var(--bg-surface);
    color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease;
}
.filter-chip.active { border-color: var(--accent-primary); color: var(--accent-primary); background: rgba(255, 214, 10, 0.08); }

.prompt-section-header {
    display: flex; align-items: center; justify-content: space-between;
}
.prompt-section-title {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 15px; color: var(--text-primary);
}
.prompt-section-badge {
    font-family: 'Silkscreen', monospace;
    font-size: 12px; color: var(--accent-primary);
    background: rgba(255, 214, 10, 0.1);
    padding: 2px 8px; border-radius: 4px;
}

.prompt-list { display: flex; flex-direction: column; gap: 10px; }
.prompt-card {
    background: var(--bg-card); border: 1.5px solid transparent; border-radius: 14px;
    padding: 16px; cursor: pointer; transition: all 0.2s ease;
    font-size: 15px; color: var(--text-primary); line-height: 1.35;
}
.prompt-card:active { transform: scale(0.98); }
.prompt-card.selected { border-color: var(--accent-primary); background: rgba(255, 214, 10, 0.05); }

.prompt-answer-area { display: none; flex-direction: column; gap: 10px; }
.prompt-answer-area.visible { display: flex; }
.prompt-answer-input {
    background: var(--bg-card); border: 1.5px solid var(--bg-elevated); border-radius: 12px;
    padding: 14px 16px; color: var(--text-primary);
    font-family: 'Space Grotesk', -apple-system, sans-serif; font-size: 15px;
    resize: none; outline: none; min-height: 70px; -webkit-appearance: none;
}
.prompt-answer-input:focus { border-color: var(--accent-primary); }
.prompt-answer-input::placeholder { color: var(--text-disabled); }
.char-count { text-align: right; font-size: 12px; color: var(--text-tertiary); }

/* Bonus summary */
.bonus-summary {
    width: 100%;
    text-align: center;
    padding: 12px;
    background: var(--bg-card);
    border-radius: 12px;
    font-family: 'Silkscreen', monospace;
    font-size: 16px;
    color: var(--accent-primary);
}

.prompt-actions {
    display: flex; flex-direction: column; align-items: center; gap: 8px;
    margin-top: 4px; padding-bottom: 20px;
}

/* ── Done Screen ── */
#done-screen { z-index: 30; overflow-y: auto; -webkit-overflow-scrolling: touch; justify-content: flex-start; padding-top: calc(var(--safe-top) + 24px); }
.done-inner { width: 100%; max-width: 390px; display: flex; flex-direction: column; align-items: center; gap: 16px; padding-bottom: 40px; }
.done-title { font-family: 'Space Grotesk', -apple-system, sans-serif; font-size: 26px; color: var(--accent-primary); text-align: center; }
.done-subtitle { font-size: 14px; color: var(--text-secondary); text-align: center; }

.done-prompt-card {
    width: 100%; background: var(--bg-card); border-radius: 16px; overflow: hidden;
    border: 1.5px solid var(--bg-elevated);
}
.done-prompt-img { width: 100%; aspect-ratio: 4/3; object-fit: cover; display: block; }
.done-prompt-body { padding: 16px; }
.done-prompt-label {
    font-family: 'Space Grotesk', -apple-system, sans-serif;
    font-size: 13px; color: var(--accent-primary); margin-bottom: 6px;
}
.done-prompt-text { font-size: 15px; color: var(--text-primary); line-height: 1.35; }
.done-prompt-bonus {
    display: inline-block; font-family: 'Silkscreen', monospace; font-size: 13px;
    color: var(--accent-primary); background: rgba(255,214,10,0.1);
    padding: 3px 10px; border-radius: 6px; margin-top: 8px;
}

.done-bonus-total {
    font-family: 'Silkscreen', monospace; font-size: 22px; color: var(--accent-primary);
    background: rgba(255, 214, 10, 0.1); padding: 10px 24px; border-radius: 12px;
    text-align: center;
}

/* ── Emoji Reactions ── */
.emoji-reaction {
    position: fixed; z-index: 200; font-size: 28px; pointer-events: none;
    animation: emojiFloat 1.2s ease-out forwards;
}
@keyframes emojiFloat {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    60% { opacity: 1; transform: translateY(-120px) scale(1.2); }
    100% { opacity: 0; transform: translateY(-200px) scale(0.8); }
}

/* ── Prompt Carousel ── */
.prompt-carousel-wrap { width: calc(100% + 48px); margin: 0 -24px; overflow: visible; }
.prompt-carousel {
    display: flex; gap: 10px; overflow-x: auto; -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory; padding: 0 24px;
    scrollbar-width: none;
}
.prompt-carousel::-webkit-scrollbar { display: none; }
.prompt-carousel-card {
    flex: 0 0 75%; scroll-snap-align: start;
    background: var(--bg-card); border: 1.5px solid transparent; border-radius: 14px;
    padding: 14px 16px; cursor: pointer; transition: all 0.2s ease;
    font-size: 14px; color: var(--text-primary); line-height: 1.35;
}
.prompt-carousel-card:active { transform: scale(0.97); }
.prompt-carousel-card.selected { border-color: var(--accent-primary); background: rgba(255,214,10,0.05); }

.prompt-response-area {
    width: 100%; display: flex; flex-direction: column; gap: 12px;
    opacity: 0; max-height: 0; overflow: hidden; transition: opacity 0.3s ease, max-height 0.3s ease;
}
.prompt-response-area.visible { opacity: 1; max-height: 600px; }

.prompt-photo-area {
    width: 100%; aspect-ratio: 4/3; max-height: 220px; border-radius: 14px;
    border: 2px dashed var(--bg-elevated); display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 6px; cursor: pointer;
    transition: all 0.3s ease; background: var(--bg-surface);
}
.prompt-photo-area:active { transform: scale(0.98); }
.prompt-photo-area.has-photo {
    border-style: solid; border-color: var(--accent-primary);
    background: linear-gradient(135deg, rgba(236,72,153,0.08), rgba(34,197,94,0.08), rgba(249,115,22,0.08), rgba(59,130,246,0.08));
}

/* ── Reduced motion ── */
@media (prefers-reduced-motion: reduce) {
    .orb { animation: none !important; }
    .quiz-card { transition: opacity 0.2s ease !important; }
    .confetti-piece, .reveal-particle { display: none !important; }
    * { transition-duration: 0.1s !important; animation-duration: 0.1s !important; }
}
</style>
</head>
<body>

<!-- Progress Bar -->
<div class="progress-area" id="progressArea">
    <div class="progress-pct" id="progressPct">0%</div>
    <div class="progress-track">
        <div class="progress-fill" id="progressFill"></div>
    </div>
</div>

<!-- Landing Screen -->
<div class="screen active" id="landing">
    <div class="orbs-container">
        <div class="orb pulse-orb"></div>
        <div class="orb glow-orb"></div>
        <div class="orb cozy-orb"></div>
        <div class="orb lore-orb"></div>
    </div>
    <div class="landing-content">
        <h1>What's Your Vibe?</h1>
        <p>Answer a few questions. We'll figure out the rest.</p>
        <button class="btn-primary" id="startBtn">Let's Go</button>
    </div>
</div>

<!-- Game Screen -->
<div class="screen" id="game">
    <div class="card-stack" id="cardStack" aria-live="polite"></div>
    <div class="swipe-hints" id="swipeHints">
        <span class="swipe-hint">&larr; Left</span>
        <span class="swipe-hint">&uarr; Skip</span>
        <span class="swipe-hint">Right &rarr;</span>
    </div>
</div>

<!-- Reveal Screen -->
<div class="screen" id="reveal">
    <div class="reveal-particles" id="revealParticles"></div>
    <div class="reveal-center">
        <div class="reveal-emoji" id="revealEmoji"></div>
        <div class="reveal-name" id="revealName"></div>
        <div class="reveal-hangout" id="revealHangout"></div>
        <div class="reveal-tagline" id="revealTagline"></div>
        <button class="btn-primary reveal-btn" id="revealBtn">See Your Results &rarr;</button>
    </div>
</div>

<!-- Results Screen -->
<div class="screen" id="results">
    <div class="results-inner" id="resultsInner"></div>
</div>

<!-- Prompt Screen -->
<div class="screen" id="prompt-screen">
    <div class="prompt-inner" id="promptInner"></div>
</div>

<!-- Done Screen -->
<div class="screen" id="done-screen">
    <div class="done-inner" id="doneContent"></div>
</div>

<script src="./assets/content.js"></script>
<script>
/* ============================
   DATA (loaded from assets/content.js)
   ARCHETYPES, PROMPTS, QUESTIONS
   ============================ */

/*
const ARCHETYPES = {
    pulse: { name:'The Pulse', emoji:'\u26A1', color:'#EC4899', hangout:'The Rooftop',
        tagline:'You bring the energy.',
        desc:"You're the spark that turns a Tuesday into a story. You thrive on momentum, new faces, and nights where nobody checks the time. People gravitate to you because you make everything feel like something's about to happen.",
        hangoutIntro:'Welcome to The Rooftop \u2014 where the view is good and the plans are optional.' },
    glow: { name:'The Glow', emoji:'\uD83D\uDD25', color:'#22C55E', hangout:'The Pitch',
        tagline:"You don't stop.",
        desc:"You're wired to push. Whether it's fitness, a side hustle, or just being a better version of yourself than yesterday, you find your flow in effort. You connect with people who match your energy and understand that showing up consistently is its own kind of magic.",
        hangoutIntro:"Welcome to The Pitch \u2014 where everyone's working on something and nobody's faking it." },
    cozy: { name:'The Cozy', emoji:'\uD83D\uDD6F\uFE0F', color:'#F97316', hangout:'The Hearth',
        tagline:'You make people feel at home.',
        desc:"You know that the best moments are usually the quietest ones. A good meal, a real conversation, a playlist that hits right. You're emotionally fluent in a way that makes people open up, and you'd take one perfect evening over ten mediocre parties.",
        hangoutIntro:'Welcome to The Hearth \u2014 pull up a chair, we saved you a spot.' },
    lore: { name:'The Lore', emoji:'\uD83D\uDCDA', color:'#3B82F6', hangout:'The Lobby',
        tagline:'You go deep.',
        desc:"When you're into something, you're into it. Tier lists, lore, the discourse \u2014 you've got opinions and receipts. You bond with people over shared obsessions and respect anyone who's unapologetically nerdy about their thing.",
        hangoutIntro:"Welcome to The Lobby \u2014 pick your character, we're about to start." },
};

const PROMPTS = {
    pulse: [
        { text:"The last time I said 'why not' and meant it", example:"Booked a one-way flight to Lisbon on a Wednesday" },
        { text:"Me in my element (you have been warned)", example:"Karaoke mic in hand, zero shame" },
        { text:"A night out isn't complete without", example:"At least one person I didn't come with" },
        { text:"The song that makes me grab someone's arm and say LISTEN", example:"Espresso by Sabrina Carpenter, still" },
        { text:"I peaked at this exact moment", example:"3am karaoke in Tokyo, singing Bohemian Rhapsody to strangers" },
    ],
    glow: [
        { text:"Currently training for / working toward", example:"A half marathon and not hating mornings" },
        { text:"The habit that changed everything for me", example:"Waking up before my alarm and actually liking it" },
        { text:"Something I'm better at than I was 6 months ago", example:"Cooking, running, and saying no" },
        { text:"Where I go to lock in", example:"This trail at 6am before the world wakes up" },
        { text:"I knew I was locked in when", example:"I turned down brunch for a long run and felt zero regret" },
    ],
    cozy: [
        { text:"My comfort rewatch that I'm not even embarrassed about", example:"Gilmore Girls, annually, no notes" },
        { text:"The meal I'd cook to impress you", example:"My grandmother's pasta recipe \u2014 4 hours, worth every minute" },
        { text:"A small thing that makes my whole day", example:"When someone remembers how I take my coffee" },
        { text:"The playlist I'd put on if you came over", example:"Somewhere between Frank Ocean and a fireplace on YouTube" },
        { text:"I feel most myself when", example:"I'm in mismatched socks, no plans, and something's in the oven" },
    ],
    lore: [
        { text:"The collection or setup I'm unreasonably proud of", example:"My bookshelf organized by vibe, not alphabet" },
        { text:"The thing I know way too much about", example:"Elden Ring lore, competitive Pok\u00E9mon, and the history of fonts" },
        { text:"A piece of media that genuinely changed how I think", example:"Disco Elysium made me reconsider every RPG I've ever played" },
        { text:"My go-to rec when someone says 'I need something new'", example:"Dungeon Meshi for anime, Hades for games" },
        { text:"The crossover I didn't know I needed", example:"Studio Ghibli x Animal Crossing energy is my entire personality" },
    ],
};

/* ── Question Bank (108 questions) ── */
const QUESTIONS = [
    // ═══ PULSE vs GLOW (18) ═══
    {id:"pg_1",  pair:"pulse_glow", text:"It's Friday night. You're choosing between:",
        optionA:{text:"\uD83C\uDF89 A party where you know nobody",archetype:"pulse"},
        optionB:{text:"\uD83C\uDF04 A 6am trail run tomorrow",archetype:"glow"}},
    {id:"pg_2",  pair:"pulse_glow", text:"Pick a life motto:",
        optionA:{text:"\uD83D\uDC80 \"Sleep when you're dead\"",archetype:"pulse"},
        optionB:{text:"\u2699\uFE0F \"Discipline is freedom\"",archetype:"glow"}},
    {id:"pg_3",  pair:"pulse_glow", text:"A better weekend morning:",
        optionA:{text:"\uD83D\uDECF\uFE0F Waking up somewhere unexpected",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCAA Crushing a workout before anyone's up",archetype:"glow"}},
    {id:"pg_4",  pair:"pulse_glow", text:"Unexpected day off. First instinct:",
        optionA:{text:"\uD83D\uDCF1 Text the group chat \"who's free?\"",archetype:"pulse"},
        optionB:{text:"\u2705 Finally knock out that thing you've been putting off",archetype:"glow"}},
    {id:"pg_5",  pair:"pulse_glow", text:"Pick an artist:",
        optionA:{text:"\uD83D\uDC83 Charli xcx",archetype:"pulse"},
        optionB:{text:"\uD83C\uDFA4 Kendrick Lamar",archetype:"glow"}},
    {id:"pg_6",  pair:"pulse_glow", text:"The notification you'd rather get:",
        optionA:{text:"\uD83D\uDCCD \"We're all going, come NOW\"",archetype:"pulse"},
        optionB:{text:"\uD83C\uDFC6 \"You hit a new personal record\"",archetype:"glow"}},
    {id:"pg_7",  pair:"pulse_glow", text:"Your phone dies at 2pm. How do you feel?",
        optionA:{text:"\uD83D\uDE30 Panicked \u2014 how will people find me?",archetype:"pulse"},
        optionB:{text:"\uD83D\uDE0C Honestly? Relieved",archetype:"glow"}},
    {id:"pg_8",  pair:"pulse_glow", text:"A compliment that hits harder:",
        optionA:{text:"\uD83C\uDF89 \"You're the life of the party\"",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCAA \"You never give up\"",archetype:"glow"}},
    {id:"pg_9",  pair:"pulse_glow", text:"You're more afraid of:",
        optionA:{text:"\uD83D\uDE31 Missing out on something legendary",archetype:"pulse"},
        optionB:{text:"\uD83D\uDE24 Wasting a day you could've used to improve",archetype:"glow"}},
    {id:"pg_10", pair:"pulse_glow", text:"Pick a trip:",
        optionA:{text:"\u2708\uFE0F Ibiza with people you just met",archetype:"pulse"},
        optionB:{text:"\uD83E\uDD7E Solo hiking the Camino de Santiago",archetype:"glow"}},
    {id:"pg_11", pair:"pulse_glow", text:"Your friend cancels plans. You:",
        optionA:{text:"\uD83D\uDCDE Immediately find a replacement plan",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCBB Use the time for your side project",archetype:"glow"}},
    {id:"pg_12", pair:"pulse_glow", text:"Which stresses you out more?",
        optionA:{text:"\uD83D\uDE2C A quiet Saturday with nothing planned",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCC9 Being behind on your goals",archetype:"glow"}},
    {id:"pg_13", pair:"pulse_glow", text:"The flex that hits harder:",
        optionA:{text:"\uD83C\uDF89 300 people know your name",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCAA You can do 100 pushups without stopping",archetype:"glow"}},
    {id:"pg_14", pair:"pulse_glow", text:"Your TikTok FYP is mostly:",
        optionA:{text:"\uD83D\uDD7A Going-out fits and party recaps",archetype:"pulse"},
        optionB:{text:"\uD83C\uDFCB\uFE0F 5am routines and meal prep content",archetype:"glow"}},
    {id:"pg_15", pair:"pulse_glow", text:"Pick your Roman Empire:",
        optionA:{text:"\uD83C\uDF19 That one night where everything hit different",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCC8 Your five-year plan",archetype:"glow"}},
    {id:"pg_16", pair:"pulse_glow", text:"The group chat just dropped a location. You:",
        optionA:{text:"\uD83D\uDE97 Already getting ready",archetype:"pulse"},
        optionB:{text:"\u23F0 Checking if it conflicts with your morning plans",archetype:"glow"}},
    {id:"pg_17", pair:"pulse_glow", text:"You're building your personal brand around:",
        optionA:{text:"\u2728 Main character energy",archetype:"pulse"},
        optionB:{text:"\uD83C\uDFAF Results speak for themselves",archetype:"glow"}},
    {id:"pg_18", pair:"pulse_glow", text:"A podcast you'd actually finish:",
        optionA:{text:"\uD83C\uDFA4 Unhinged celebrity interview",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCCA How someone built their empire from zero",archetype:"glow"}},

    // ═══ PULSE vs COZY (18) ═══
    {id:"pc_1",  pair:"pulse_cozy", text:"A better night looks like:",
        optionA:{text:"\uD83C\uDF03 Rooftop bar with a DJ and strangers",archetype:"pulse"},
        optionB:{text:"\uD83D\uDD6F\uFE0F Couch, candle, and a movie only you've heard of",archetype:"cozy"}},
    {id:"pc_2",  pair:"pulse_cozy", text:"Pick a happy place:",
        optionA:{text:"\uD83C\uDF05 A crowded festival at golden hour",archetype:"pulse"},
        optionB:{text:"\uD83C\uDF27\uFE0F A rainy window with tea and a book",archetype:"cozy"}},
    {id:"pc_3",  pair:"pulse_cozy", text:"What sounds worse?",
        optionA:{text:"\uD83D\uDE29 \"Let's just stay in\"",archetype:"pulse"},
        optionB:{text:"\uD83D\uDE16 \"There's a huge crowd\"",archetype:"cozy"}},
    {id:"pc_4",  pair:"pulse_cozy", text:"Pick a comfort item:",
        optionA:{text:"\uD83C\uDFB5 Your going-out playlist",archetype:"pulse"},
        optionB:{text:"\uD83D\uDC55 Your favorite hoodie",archetype:"cozy"}},
    {id:"pc_5",  pair:"pulse_cozy", text:"How many close friends do you need?",
        optionA:{text:"\uD83D\uDC65 The more the better",archetype:"pulse"},
        optionB:{text:"\u270B I can count them on one hand",archetype:"cozy"}},
    {id:"pc_6",  pair:"pulse_cozy", text:"You'd rather be known as:",
        optionA:{text:"\uD83D\uDE4C The one who's always down",archetype:"pulse"},
        optionB:{text:"\uD83D\uDC9B The one everyone goes to when they need to talk",archetype:"cozy"}},
    {id:"pc_7",  pair:"pulse_cozy", text:"A better first date:",
        optionA:{text:"\uD83C\uDFB6 Concert tickets to someone you both like",archetype:"pulse"},
        optionB:{text:"\uD83C\uDF73 Cooking dinner together from a new recipe",archetype:"cozy"}},
    {id:"pc_8",  pair:"pulse_cozy", text:"Pick a vibe:",
        optionA:{text:"\uD83C\uDF19 \"Let's see where the night takes us\"",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCCB \"I made us a reservation\"",archetype:"cozy"}},
    {id:"pc_9",  pair:"pulse_cozy", text:"Your camera roll is mostly:",
        optionA:{text:"\uD83D\uDCF8 Nights out, group shots, random adventures",archetype:"pulse"},
        optionB:{text:"\uD83D\uDC15 Food, pets, sunsets, screenshots of feelings",archetype:"cozy"}},
    {id:"pc_10", pair:"pulse_cozy", text:"A bigger red flag:",
        optionA:{text:"\uD83D\uDEA9 They never want to go out",archetype:"pulse"},
        optionB:{text:"\uD83D\uDEA9 They can't sit still for 10 minutes",archetype:"cozy"}},
    {id:"pc_11", pair:"pulse_cozy", text:"Pick a musician:",
        optionA:{text:"\uD83D\uDC83 Doja Cat",archetype:"pulse"},
        optionB:{text:"\uD83C\uDFB8 Phoebe Bridgers",archetype:"cozy"}},
    {id:"pc_12", pair:"pulse_cozy", text:"The memory you'd relive:",
        optionA:{text:"\u2728 A night that became a story you still tell",archetype:"pulse"},
        optionB:{text:"\uD83D\uDC95 A quiet moment with someone who really gets you",archetype:"cozy"}},
    {id:"pc_13", pair:"pulse_cozy", text:"Pick a comfort content format:",
        optionA:{text:"\uD83D\uDCF1 A live reality show with voting",archetype:"pulse"},
        optionB:{text:"\uD83D\uDECB\uFE0F A 90s sitcom you've seen 4 times",archetype:"cozy"}},
    {id:"pc_14", pair:"pulse_cozy", text:"Honest vibe check \u2014 it's Friday 11pm:",
        optionA:{text:"\u26A1 Just getting started",archetype:"pulse"},
        optionB:{text:"\uD83D\uDE34 Already in bed, zero regrets",archetype:"cozy"}},
    {id:"pc_15", pair:"pulse_cozy", text:"Pick a weekend plan:",
        optionA:{text:"\uD83C\uDFAA A pop-up you saw on Instagram",archetype:"pulse"},
        optionB:{text:"\uD83E\uDDF6 A craft project you'll probably never finish",archetype:"cozy"}},
    {id:"pc_16", pair:"pulse_cozy", text:"The dating app photo that's more you:",
        optionA:{text:"\uD83E\uDD42 You at an event looking like you belong",archetype:"pulse"},
        optionB:{text:"\uD83D\uDC31 You with a pet looking cozy",archetype:"cozy"}},
    {id:"pc_17", pair:"pulse_cozy", text:"A compliment that would make your whole week:",
        optionA:{text:"\uD83C\uDF1F \"You're literally the main character\"",archetype:"pulse"},
        optionB:{text:"\uD83E\uDEC2 \"Talking to you feels like a warm hug\"",archetype:"cozy"}},
    {id:"pc_18", pair:"pulse_cozy", text:"The candle or the club:",
        optionA:{text:"\uD83C\uDF78 A cocktail at the new place everyone's at",archetype:"pulse"},
        optionB:{text:"\uD83D\uDD6F\uFE0F Literally an actual candle, at home, right now",archetype:"cozy"}},

    // ═══ PULSE vs LORE (18) ═══
    {id:"pl_1",  pair:"pulse_lore", text:"At a party, you're most likely:",
        optionA:{text:"\uD83E\uDD1D Introducing people who should know each other",archetype:"pulse"},
        optionB:{text:"\uD83D\uDDE3\uFE0F In the corner having an intense niche conversation",archetype:"lore"}},
    {id:"pl_2",  pair:"pulse_lore", text:"Pick a superpower:",
        optionA:{text:"\u26A1 Teleportation \u2014 be anywhere instantly",archetype:"pulse"},
        optionB:{text:"\uD83E\uDDE0 Photographic memory \u2014 never forget anything",archetype:"lore"}},
    {id:"pl_3",  pair:"pulse_lore", text:"A better rabbit hole:",
        optionA:{text:"\uD83D\uDDFA\uFE0F A new city with no itinerary",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCFA A 45-part video essay on something random",archetype:"lore"}},
    {id:"pl_4",  pair:"pulse_lore", text:"The better flex:",
        optionA:{text:"\uD83D\uDC4B Knowing everyone in the room",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCDA Knowing everything about one specific thing",archetype:"lore"}},
    {id:"pl_5",  pair:"pulse_lore", text:"Pick a compliment:",
        optionA:{text:"\uD83C\uDF10 \"You know everyone\"",archetype:"pulse"},
        optionB:{text:"\uD83E\uDDE0 \"You know everything\"",archetype:"lore"}},
    {id:"pl_6",  pair:"pulse_lore", text:"You'd rather watch:",
        optionA:{text:"\uD83C\uDFDF\uFE0F A live event \u2014 concert, game, fight night",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCFA A limited series everyone's sleeping on",archetype:"lore"}},
    {id:"pl_7",  pair:"pulse_lore", text:"Your Wikipedia history is mostly:",
        optionA:{text:"\uD83D\uDC64 People you just met or heard about",archetype:"pulse"},
        optionB:{text:"\uD83D\uDD0D Obscure topics you fell into at 2am",archetype:"lore"}},
    {id:"pl_8",  pair:"pulse_lore", text:"When someone recommends something:",
        optionA:{text:"\uD83D\uDC4D You'll check it out if enough people co-sign",archetype:"pulse"},
        optionB:{text:"\uD83E\uDD14 You need to know WHY they think it's good",archetype:"lore"}},
    {id:"pl_9",  pair:"pulse_lore", text:"The thing that makes you lose track of time:",
        optionA:{text:"\uD83D\uDCAC A great conversation with new people",archetype:"pulse"},
        optionB:{text:"\uD83D\uDD2C Going deep on something you're obsessed with",archetype:"lore"}},
    {id:"pl_10", pair:"pulse_lore", text:"Pick a show format:",
        optionA:{text:"\uD83D\uDCFA Reality TV \u2014 the chaos, the drama",archetype:"pulse"},
        optionB:{text:"\uD83C\uDFAC A documentary that changes your perspective",archetype:"lore"}},
    {id:"pl_11", pair:"pulse_lore", text:"Pick a group chat energy:",
        optionA:{text:"\uD83D\uDE02 Sending memes and making plans",archetype:"pulse"},
        optionB:{text:"\uD83D\uDD17 Sending links with \"you NEED to see this\"",archetype:"lore"}},
    {id:"pl_12", pair:"pulse_lore", text:"Choose an era to time-travel to:",
        optionA:{text:"\uD83C\uDFBA The roaring '20s \u2014 jazz, parties, chaos",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCDC Ancient Alexandria \u2014 the library, the scholars",archetype:"lore"}},
    {id:"pl_13", pair:"pulse_lore", text:"Your browser tabs right now:",
        optionA:{text:"\uD83D\uDCAC 17 group chat links and event pages",archetype:"pulse"},
        optionB:{text:"\uD83D\uDCD1 47 research tabs on something no one asked about",archetype:"lore"}},
    {id:"pl_14", pair:"pulse_lore", text:"At trivia night, you bring:",
        optionA:{text:"\uD83E\uDD1D The vibes and team spirit",archetype:"pulse"},
        optionB:{text:"\uD83E\uDDE0 The actual answers",archetype:"lore"}},
    {id:"pl_15", pair:"pulse_lore", text:"Someone says \"tell me a fun fact.\" You:",
        optionA:{text:"\uD83D\uDE05 Panic and say something about yourself",archetype:"pulse"},
        optionB:{text:"\uD83E\uDD13 Already have 12 queued up",archetype:"lore"}},
    {id:"pl_16", pair:"pulse_lore", text:"Your villain origin story:",
        optionA:{text:"\uD83D\uDE24 Not being invited to the thing",archetype:"pulse"},
        optionB:{text:"\uD83D\uDE20 Someone getting basic facts wrong about your thing",archetype:"lore"}},
    {id:"pl_17", pair:"pulse_lore", text:"Pick a date activity:",
        optionA:{text:"\uD83C\uDFB3 Something active where you can talk and laugh",archetype:"pulse"},
        optionB:{text:"\uD83C\uDFAE Co-op gaming or wandering a museum",archetype:"lore"}},
    {id:"pl_18", pair:"pulse_lore", text:"Your notifications are basically:",
        optionA:{text:"\uD83D\uDCF2 A group chat explosion every 5 minutes",archetype:"pulse"},
        optionB:{text:"\uD83D\uDD15 Permanently on silent \u2014 you'll check eventually",archetype:"lore"}},

    // ═══ GLOW vs COZY (18) ═══
    {id:"gc_1",  pair:"glow_cozy", text:"A better Sunday:",
        optionA:{text:"\uD83D\uDCCB Meal prep, gym, plan the week",archetype:"glow"},
        optionB:{text:"\uD83D\uDE34 Sleep in, slow breakfast, no agenda",archetype:"cozy"}},
    {id:"gc_2",  pair:"glow_cozy", text:"Which hits closer to home?",
        optionA:{text:"\uD83D\uDCC8 \"I can always do better\"",archetype:"glow"},
        optionB:{text:"\uD83E\uDDD8 \"I'm learning to be okay with where I am\"",archetype:"cozy"}},
    {id:"gc_3",  pair:"glow_cozy", text:"Pick a drink:",
        optionA:{text:"\uD83E\uDD64 A protein shake at 6:30am",archetype:"glow"},
        optionB:{text:"\u2615 Hot chocolate at 10pm",archetype:"cozy"}},
    {id:"gc_4",  pair:"glow_cozy", text:"The quality you value more in a friend:",
        optionA:{text:"\uD83D\uDD25 They push you to be better",archetype:"glow"},
        optionB:{text:"\uD83E\uDD17 They accept you exactly as you are",archetype:"cozy"}},
    {id:"gc_5",  pair:"glow_cozy", text:"You'd rather someone say:",
        optionA:{text:"\uD83D\uDCAB \"You inspire me\"",archetype:"glow"},
        optionB:{text:"\uD83D\uDEE1\uFE0F \"You make me feel safe\"",archetype:"cozy"}},
    {id:"gc_6",  pair:"glow_cozy", text:"Your alarm goes off early. First thought:",
        optionA:{text:"\u23F0 Good \u2014 I'm ahead of everyone else",archetype:"glow"},
        optionB:{text:"\uD83D\uDE34 *hits snooze with zero guilt*",archetype:"cozy"}},
    {id:"gc_7",  pair:"glow_cozy", text:"A bigger dealbreaker in a partner:",
        optionA:{text:"\uD83D\uDEA9 No ambition",archetype:"glow"},
        optionB:{text:"\uD83D\uDEA9 No emotional availability",archetype:"cozy"}},
    {id:"gc_8",  pair:"glow_cozy", text:"Pick a vacation style:",
        optionA:{text:"\u26F0\uFE0F Active \u2014 hiking, training camp, adventure sport",archetype:"glow"},
        optionB:{text:"\uD83C\uDFE0 Cabin \u2014 fireplace, board games, slow mornings",archetype:"cozy"}},
    {id:"gc_9",  pair:"glow_cozy", text:"Your Instagram aesthetic is closer to:",
        optionA:{text:"\uD83D\uDCAA Gym selfies, sunrise runs, progress pics",archetype:"glow"},
        optionB:{text:"\u2615 Coffee shots, golden hour, \"life lately\" carousels",archetype:"cozy"}},
    {id:"gc_10", pair:"glow_cozy", text:"Pick a quote:",
        optionA:{text:"\uD83D\uDCAC \"Hard work beats talent when talent doesn't work hard\"",archetype:"glow"},
        optionB:{text:"\uD83D\uDCAC \"Rest is not the opposite of productivity\"",archetype:"cozy"}},
    {id:"gc_11", pair:"glow_cozy", text:"You bond with people over:",
        optionA:{text:"\uD83C\uDFAF Shared goals and mutual accountability",archetype:"glow"},
        optionB:{text:"\uD83D\uDC97 Shared feelings and comfortable silence",archetype:"cozy"}},
    {id:"gc_12", pair:"glow_cozy", text:"The worst thing someone could say about you:",
        optionA:{text:"\uD83D\uDE28 \"They peaked\"",archetype:"glow"},
        optionB:{text:"\uD83D\uDE28 \"They're cold\"",archetype:"cozy"}},
    {id:"gc_13", pair:"glow_cozy", text:"Your morning alarm label:",
        optionA:{text:"\uD83C\uDF05 RISE AND GRIND",archetype:"glow"},
        optionB:{text:"\uD83E\uDD50 \"not yet bestie\"",archetype:"cozy"}},
    {id:"gc_14", pair:"glow_cozy", text:"The more valid reason to cancel plans:",
        optionA:{text:"\uD83C\uDFC3 Training for something",archetype:"glow"},
        optionB:{text:"\uD83E\uDED6 Need a mental health night",archetype:"cozy"}},
    {id:"gc_15", pair:"glow_cozy", text:"A gift you'd actually want:",
        optionA:{text:"\uD83C\uDFA7 Nice headphones or a fitness tracker",archetype:"glow"},
        optionB:{text:"\uD83E\uDDF8 A handmade scrapbook or cozy blanket",archetype:"cozy"}},
    {id:"gc_16", pair:"glow_cozy", text:"Your notes app is mostly:",
        optionA:{text:"\u2705 Goals, PRs, and motivational quotes",archetype:"glow"},
        optionB:{text:"\uD83D\uDCDD Song lyrics, recipe links, and random feelings",archetype:"cozy"}},
    {id:"gc_17", pair:"glow_cozy", text:"A hot take:",
        optionA:{text:"\uD83D\uDD25 Rest days feel like wasted days",archetype:"glow"},
        optionB:{text:"\uD83E\uDDCA Ambition culture is lowkey exhausting",archetype:"cozy"}},
    {id:"gc_18", pair:"glow_cozy", text:"Pick an aesthetic:",
        optionA:{text:"\uD83D\uDDA4 Clean girl / that girl energy",archetype:"glow"},
        optionB:{text:"\uD83E\uDD0E Cottagecore or dark academia",archetype:"cozy"}},

    // ═══ GLOW vs LORE (18) ═══
    {id:"gl_1",  pair:"glow_lore", text:"Pick a flex:",
        optionA:{text:"\uD83C\uDFC3 Running a marathon",archetype:"glow"},
        optionB:{text:"\uD83C\uDFAE Beating a game on the hardest difficulty",archetype:"lore"}},
    {id:"gl_2",  pair:"glow_lore", text:"What motivates you more?",
        optionA:{text:"\uD83D\uDCCA A leaderboard",archetype:"glow"},
        optionB:{text:"\uD83D\uDD2E A mystery",archetype:"lore"}},
    {id:"gl_3",  pair:"glow_lore", text:"Pick a role in a heist movie:",
        optionA:{text:"\uD83C\uDFCB\uFE0F The one who trained for months to pull it off",archetype:"glow"},
        optionB:{text:"\uD83D\uDDA5\uFE0F The one who planned every detail from a dark room",archetype:"lore"}},
    {id:"gl_4",  pair:"glow_lore", text:"Pick a bookshelf:",
        optionA:{text:"\uD83D\uDCD6 Self-improvement, biographies, how-to",archetype:"glow"},
        optionB:{text:"\uD83D\uDCDA Fantasy, sci-fi, manga, deep non-fiction",archetype:"lore"}},
    {id:"gl_5",  pair:"glow_lore", text:"When you admire someone, it's usually because:",
        optionA:{text:"\uD83D\uDCAA They put in the work and it shows",archetype:"glow"},
        optionB:{text:"\uD83E\uDDE0 They know things most people don't",archetype:"lore"}},
    {id:"gl_6",  pair:"glow_lore", text:"A skill you'd rather master:",
        optionA:{text:"\u26BD A sport or physical discipline",archetype:"glow"},
        optionB:{text:"\uD83C\uDFB9 A language or instrument",archetype:"lore"}},
    {id:"gl_7",  pair:"glow_lore", text:"The better compliment:",
        optionA:{text:"\uD83E\uDD16 \"You're a machine\"",archetype:"glow"},
        optionB:{text:"\uD83E\uDDE0 \"You're a genius\"",archetype:"lore"}},
    {id:"gl_8",  pair:"glow_lore", text:"How do you learn new things?",
        optionA:{text:"\uD83D\uDD28 By doing \u2014 trial, error, repetition",archetype:"glow"},
        optionB:{text:"\uD83D\uDCD6 By researching \u2014 reading, watching, absorbing",archetype:"lore"}},
    {id:"gl_9",  pair:"glow_lore", text:"Your comfort zone is:",
        optionA:{text:"\uD83D\uDE80 Something you're actively trying to leave",archetype:"glow"},
        optionB:{text:"\uD83C\uDFAE Something you've customized perfectly",archetype:"lore"}},
    {id:"gl_10", pair:"glow_lore", text:"Pick a duo:",
        optionA:{text:"\uD83E\uDD4A Rocky and Apollo Creed",archetype:"glow"},
        optionB:{text:"\uD83E\uDDD9 Frodo and Samwise",archetype:"lore"}},
    {id:"gl_11", pair:"glow_lore", text:"When something goes wrong, your instinct:",
        optionA:{text:"\uD83D\uDD27 Work harder until you fix it",archetype:"glow"},
        optionB:{text:"\uD83D\uDD0D Figure out exactly what happened and why",archetype:"lore"}},
    {id:"gl_12", pair:"glow_lore", text:"Your dream collab partner:",
        optionA:{text:"\uD83C\uDFCB\uFE0F A coach who gets the best out of you",archetype:"glow"},
        optionB:{text:"\uD83C\uDFA8 A creator whose work you're obsessed with",archetype:"lore"}},
    {id:"gl_13", pair:"glow_lore", text:"Your screen time is mostly:",
        optionA:{text:"\uD83D\uDCF1 Fitness apps and productivity tools",archetype:"glow"},
        optionB:{text:"\uD83C\uDF10 YouTube, Reddit, and wiki rabbit holes",archetype:"lore"}},
    {id:"gl_14", pair:"glow_lore", text:"Why you're still up at 1am:",
        optionA:{text:"\uD83C\uDFC3 Couldn't sleep, might as well get ahead",archetype:"glow"},
        optionB:{text:"\uD83C\uDF00 Fell into a rabbit hole and there's no going back",archetype:"lore"}},
    {id:"gl_15", pair:"glow_lore", text:"A childhood flex:",
        optionA:{text:"\uD83C\uDFC6 You won a sports trophy",archetype:"glow"},
        optionB:{text:"\uD83C\uDFAE You 100%'d a video game",archetype:"lore"}},
    {id:"gl_16", pair:"glow_lore", text:"Your hero is someone who:",
        optionA:{text:"\uD83C\uDFD4\uFE0F Climbed from nothing through pure grind",archetype:"glow"},
        optionB:{text:"\uD83D\uDD2C Discovered something that changed the world",archetype:"lore"}},
    {id:"gl_17", pair:"glow_lore", text:"You'd rather be internet-famous for:",
        optionA:{text:"\uD83C\uDFC5 An achievement everyone respects",archetype:"glow"},
        optionB:{text:"\uD83D\uDCD6 Creating something a niche audience worships",archetype:"lore"}},
    {id:"gl_18", pair:"glow_lore", text:"The app you check first thing:",
        optionA:{text:"\uD83D\uDCCA Your habit tracker or workout log",archetype:"glow"},
        optionB:{text:"\uD83D\uDDC2\uFE0F Discord, Reddit, or a fandom forum",archetype:"lore"}},

    // ═══ COZY vs LORE (18) ═══
    {id:"cl_1",  pair:"cozy_lore", text:"A better rainy day:",
        optionA:{text:"\uD83C\uDF70 Baking something from scratch",archetype:"cozy"},
        optionB:{text:"\uD83C\uDFAE Starting a new game or rewatch",archetype:"lore"}},
    {id:"cl_2",  pair:"cozy_lore", text:"Pick a conversation topic with someone new:",
        optionA:{text:"\uD83D\uDE0A \"What made you really happy recently?\"",archetype:"cozy"},
        optionB:{text:"\uD83E\uDD14 \"What could you talk about for an hour?\"",archetype:"lore"}},
    {id:"cl_3",  pair:"cozy_lore", text:"The thing you collect:",
        optionA:{text:"\uD83D\uDCDD Recipes, playlists, moments",archetype:"cozy"},
        optionB:{text:"\uD83D\uDCCA Facts, references, rankings",archetype:"lore"}},
    {id:"cl_4",  pair:"cozy_lore", text:"Your love language is closer to:",
        optionA:{text:"\uD83C\uDF81 Acts of service \u2014 I made this for you",archetype:"cozy"},
        optionB:{text:"\uD83D\uDD50 Quality time \u2014 let's do our favorite thing together",archetype:"lore"}},
    {id:"cl_5",  pair:"cozy_lore", text:"Pick a type of YouTube video:",
        optionA:{text:"\uD83C\uDF73 A calm cooking or pottery channel",archetype:"cozy"},
        optionB:{text:"\uD83C\uDFAC A 3-hour analysis of why a movie actually works",archetype:"lore"}},
    {id:"cl_6",  pair:"cozy_lore", text:"What you notice first about someone's space:",
        optionA:{text:"\uD83C\uDFE1 Whether it feels warm and lived-in",archetype:"cozy"},
        optionB:{text:"\uD83D\uDCDA What's on their shelves and walls",archetype:"lore"}},
    {id:"cl_7",  pair:"cozy_lore", text:"Pick a form of escapism:",
        optionA:{text:"\uD83D\uDCFA Comfort rewatches and familiar rituals",archetype:"cozy"},
        optionB:{text:"\uD83C\uDF0D A new world to learn everything about",archetype:"lore"}},
    {id:"cl_8",  pair:"cozy_lore", text:"The way to your heart:",
        optionA:{text:"\uD83D\uDC9D Remembering the small things I mentioned once",archetype:"cozy"},
        optionB:{text:"\uD83E\uDD29 Getting genuinely excited about something I love too",archetype:"lore"}},
    {id:"cl_9",  pair:"cozy_lore", text:"Pick a holiday gift:",
        optionA:{text:"\uD83C\uDF81 Something handmade or deeply personal",archetype:"cozy"},
        optionB:{text:"\uD83D\uDC8E Something rare from a niche they're into",archetype:"lore"}},
    {id:"cl_10", pair:"cozy_lore", text:"When you really like something:",
        optionA:{text:"\uD83C\uDF77 You savour it slowly",archetype:"cozy"},
        optionB:{text:"\uD83C\uDFC3 You consume everything related to it immediately",archetype:"lore"}},
    {id:"cl_11", pair:"cozy_lore", text:"A better co-op activity:",
        optionA:{text:"\uD83E\uDDE9 A jigsaw puzzle or board game by the fire",archetype:"cozy"},
        optionB:{text:"\uD83C\uDFD7\uFE0F Building in Minecraft or a TTRPG campaign",archetype:"lore"}},
    {id:"cl_12", pair:"cozy_lore", text:"A trait you find more attractive:",
        optionA:{text:"\uD83D\uDC9B Emotional intelligence",archetype:"cozy"},
        optionB:{text:"\uD83D\uDD25 Passionate expertise",archetype:"lore"}},
    {id:"cl_13", pair:"cozy_lore", text:"Pick a road trip vibe:",
        optionA:{text:"\uD83C\uDFB5 Curated playlist and a snack bag you packed at midnight",archetype:"cozy"},
        optionB:{text:"\uD83C\uDFA7 A podcast deep-dive and gas station energy drinks",archetype:"lore"}},
    {id:"cl_14", pair:"cozy_lore", text:"Your bookmarks folder:",
        optionA:{text:"\uD83D\uDCCC Recipes, cute cafes, and gift ideas",archetype:"cozy"},
        optionB:{text:"\uD83D\uDD16 Lore explainers, tier lists, and build guides",archetype:"lore"}},
    {id:"cl_15", pair:"cozy_lore", text:"The way you show love:",
        optionA:{text:"\uD83C\uDF6A \"I baked this for you at 11pm\"",archetype:"cozy"},
        optionB:{text:"\uD83D\uDCCE \"I found this article and thought of you\"",archetype:"lore"}},
    {id:"cl_16", pair:"cozy_lore", text:"What keeps you up at 2am:",
        optionA:{text:"\uD83D\uDCAD Overthinking a conversation from 3 years ago",archetype:"cozy"},
        optionB:{text:"\uD83D\uDCFA One more episode / one more chapter",archetype:"lore"}},
    {id:"cl_17", pair:"cozy_lore", text:"Your comfort food order:",
        optionA:{text:"\uD83C\uDF72 Whatever reminds you of home",archetype:"cozy"},
        optionB:{text:"\uD83C\uDF55 The exact same order from your spot, no changes, ever",archetype:"lore"}},
    {id:"cl_18", pair:"cozy_lore", text:"Pick a creative outlet:",
        optionA:{text:"\u270D\uFE0F Journaling or making playlists",archetype:"cozy"},
        optionB:{text:"\uD83C\uDFA8 Building worlds or making tier lists",archetype:"lore"}},
];

*/

/* ============================
   STATE
   ============================ */

const state = {
    phase: 'landing',
    scores: { pulse: 0, glow: 0, cozy: 0, lore: 0 },
    skipsPerArchetype: { pulse: 0, glow: 0, cozy: 0, lore: 0 },
    questionsAsked: new Set(),
    questionsAnswered: 0,
    questionsSkipped: 0,
    totalAsked: 0,
    displayedProgress: 0,
    results: null,
    recentChoices: [],
    promptBonus: 0,
};

/* ============================
   HELPERS
   ============================ */

function $(sel) { return document.querySelector(sel); }
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}
function haptic(type) {
    if (!navigator.vibrate) return;
    if (type === 'light') navigator.vibrate(10);
    else if (type === 'medium') navigator.vibrate(20);
    else if (type === 'heavy') navigator.vibrate([30, 100, 10]);
}

/* ============================
   QUESTION ALGORITHM
   ============================ */

function selectNextQuestion() {
    const s = state.scores;
    const pairs = [
        { pair:'pulse_glow', sep: Math.abs(s.pulse - s.glow) },
        { pair:'pulse_cozy', sep: Math.abs(s.pulse - s.cozy) },
        { pair:'pulse_lore', sep: Math.abs(s.pulse - s.lore) },
        { pair:'glow_cozy',  sep: Math.abs(s.glow  - s.cozy) },
        { pair:'glow_lore',  sep: Math.abs(s.glow  - s.lore) },
        { pair:'cozy_lore',  sep: Math.abs(s.cozy  - s.lore) },
    ];
    pairs.sort((a, b) => a.sep - b.sep);
    for (const p of pairs) {
        const available = QUESTIONS.filter(q => q.pair === p.pair && !state.questionsAsked.has(q.id));
        if (available.length > 0) return available[Math.floor(Math.random() * available.length)];
    }
    return null;
}

function shouldTerminate() {
    if (state.totalAsked >= 25) return true;
    if (state.questionsAnswered < 10) return false;
    const sorted = Object.values(state.scores).sort((a, b) => b - a);
    const primaryGap = sorted[0] - sorted[1];
    const secondaryGap = sorted[1] - sorted[2];
    if (state.questionsAnswered >= 12 && primaryGap >= 2.0 && secondaryGap >= 1.0) return true;
    if (state.questionsAnswered >= 18 && primaryGap >= 1.5) return true;
    return false;
}

/*
 * Progress bar v2 — more pessimistic.
 * Base progress grows slowly (caps at 30%).
 * Confidence uses geometric mean of how close primary/secondary gaps
 * are to termination thresholds, so split profiles stall around 40-55%
 * instead of racing to 99%.
 */
function calculateProgress() {
    const baseProgress = Math.min(state.questionsAnswered / 28, 0.30);
    const sorted = Object.values(state.scores).sort((a, b) => b - a);
    let confidence = 0;
    if (sorted.length >= 3) {
        const primaryRatio = Math.min((sorted[0] - sorted[1]) / 2.5, 1.0);
        const secondaryRatio = Math.min((sorted[1] - sorted[2]) / 1.5, 1.0);
        confidence = Math.sqrt(primaryRatio * secondaryRatio) * 0.70;
    }
    const raw = baseProgress + confidence;
    // Minimum floor: ~2.5% per answered question (skips don't advance progress)
    const floor = Math.min(state.questionsAnswered * 0.025, 0.95);
    return Math.min(Math.max(raw, floor), 0.99);
}

function updateProgress(final) {
    let pct = final ? 1 : calculateProgress();
    pct = Math.max(pct, state.displayedProgress);
    state.displayedProgress = pct;
    const display = Math.round(pct * 100);
    $('#progressPct').textContent = display + '%';
    $('#progressFill').style.width = display + '%';
}

/* ============================
   RESULTS COMPUTATION
   ============================ */

function computeResults() {
    const s = state.scores;
    const entries = Object.entries(s).sort((a, b) => b[1] - a[1]);
    // Tie-breaking
    if (entries[0][1] === entries[1][1]) {
        const skipA = state.skipsPerArchetype[entries[0][0]] || 0;
        const skipB = state.skipsPerArchetype[entries[1][0]] || 0;
        if (skipA !== skipB) {
            if (skipA > skipB) [entries[0], entries[1]] = [entries[1], entries[0]];
        } else {
            const recent = state.recentChoices.slice(-5);
            const countA = recent.filter(c => c === entries[0][0]).length;
            const countB = recent.filter(c => c === entries[1][0]).length;
            if (countB > countA) [entries[0], entries[1]] = [entries[1], entries[0]];
        }
    }
    const primary = entries[0][0];
    const secondary = entries[1][0];
    const total = Object.values(s).reduce((a, b) => a + b, 0);
    if (total === 0) {
        return { mystery: true, primary: null, secondary: null,
            affinities: { pulse:25, glow:25, cozy:25, lore:25 },
            karma: { pulse:25, glow:25, cozy:25, lore:25 } };
    }
    const affinities = {};
    for (const [k, v] of Object.entries(s)) affinities[k] = Math.round((v / total) * 100);
    const bonusForPrimary = 20, remainingKarma = 80;
    const karma = {};
    for (const [k, v] of Object.entries(s)) karma[k] = Math.round((v / total) * remainingKarma);
    karma[primary] += bonusForPrimary;
    karma[primary] += (100 - Object.values(karma).reduce((a, b) => a + b, 0));
    return { mystery: false, primary, secondary, affinities, karma };
}

/* ============================
   CARD RENDERING & SWIPING
   ============================ */

let currentCardEl = null;
let touchStartX = 0, touchStartY = 0;
let isDragging = false;
let cardLocked = false;

function createQuestionCard(q) {
    const card = document.createElement('div');
    card.className = 'quiz-card';
    card.setAttribute('role', 'group');
    card.setAttribute('aria-live', 'polite');
    const colorA = ARCHETYPES[q.optionA.archetype].color;
    const colorB = ARCHETYPES[q.optionB.archetype].color;
    card.style.background = `linear-gradient(90deg, ${colorA}0D 0%, ${colorA}05 30%, ${colorB}05 70%, ${colorB}0D 100%), var(--bg-card)`;
    card.innerHTML = `
        <div class="swipe-indicator left-ind">← THIS</div>
        <div class="swipe-indicator right-ind">THAT →</div>
        <div class="card-question">${q.text}</div>
        <div class="card-divider"><div class="line"></div><div class="vs">VS</div><div class="line"></div></div>
        <div class="card-options">
            <div class="card-option left">${q.optionA.text}</div>
            <div class="card-option right">${q.optionB.text}</div>
        </div>
        <div class="swipe-indicator skip-ind">SKIP ↑</div>`;
    return card;
}

function createTutorialCard() {
    const card = document.createElement('div');
    card.className = 'quiz-card';
    card.innerHTML = `
        <div class="tutorial-content">
            <h2>Swipe to vibe</h2>
            <div class="tutorial-hints">
                <div class="tutorial-hint"><span class="arrow">←</span><span>This one</span></div>
                <div class="tutorial-hint"><span class="arrow">→</span><span>That one</span></div>
                <div class="tutorial-hint"><span class="arrow">↑</span><span>Skip</span></div>
            </div>
            <div class="tutorial-footer">No wrong answers. Go with your gut.</div>
            <button class="btn-primary" id="tutorialGotIt">Got it</button>
        </div>`;
    return card;
}

function mountCard(cardEl, animated) {
    const stack = $('#cardStack');
    stack.innerHTML = '';
    stack.appendChild(cardEl);
    currentCardEl = cardEl;
    if (animated) {
        cardEl.style.opacity = '0';
        cardEl.style.transform = 'translateY(40px) scale(0.95)';
        requestAnimationFrame(() => {
            cardEl.style.transition = 'transform 0.3s cubic-bezier(0, 0, 0.2, 1), opacity 0.3s ease-out';
            cardEl.style.opacity = '1';
            cardEl.style.transform = 'translateY(0) scale(1)';
        });
    }
    attachSwipe(cardEl);
}

function attachSwipe(card) {
    const onStart = (e) => {
        if (cardLocked) return;
        const t = e.touches ? e.touches[0] : e;
        touchStartX = t.clientX; touchStartY = t.clientY;
        isDragging = true;
        card.style.transition = 'none';
    };
    const onMove = (e) => {
        if (!isDragging || cardLocked) return;
        e.preventDefault();
        const t = e.touches ? e.touches[0] : e;
        const dx = t.clientX - touchStartX, dy = t.clientY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) {
            card.style.transform = `translateX(${dx}px) rotate(${dx * 0.05}deg)`;
            const li = card.querySelector('.left-ind'), ri = card.querySelector('.right-ind'), si = card.querySelector('.skip-ind');
            if (li) li.style.opacity = dx < -40 ? Math.min((-dx - 40) / 40, 1) : 0;
            if (ri) ri.style.opacity = dx > 40 ? Math.min((dx - 40) / 40, 1) : 0;
            if (si) si.style.opacity = 0;
        } else if (dy < -20) {
            card.style.transform = `translateY(${dy}px) scale(${Math.max(1 + dy * 0.001, 0.85)})`;
            const si = card.querySelector('.skip-ind'), li = card.querySelector('.left-ind'), ri = card.querySelector('.right-ind');
            if (si) si.style.opacity = dy < -30 ? Math.min((-dy - 30) / 30, 1) : 0;
            if (li) li.style.opacity = 0;
            if (ri) ri.style.opacity = 0;
        }
    };
    const onEnd = (e) => {
        if (!isDragging || cardLocked) return;
        isDragging = false;
        const t = e.changedTouches ? e.changedTouches[0] : e;
        const dx = t.clientX - touchStartX, dy = t.clientY - touchStartY;
        if (dx > 80) dismissCard('right');
        else if (dx < -80) dismissCard('left');
        else if (dy < -60 && Math.abs(dx) < 40) dismissCard('up');
        else {
            card.style.transition = 'transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            card.style.transform = 'translateX(0) rotate(0)';
            card.querySelectorAll('.swipe-indicator').forEach(i => i.style.opacity = 0);
        }
    };
    card.addEventListener('touchstart', onStart, { passive: true });
    card.addEventListener('touchmove', onMove, { passive: false });
    card.addEventListener('touchend', onEnd, { passive: true });
    card.addEventListener('mousedown', onStart);
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onEnd);

    // Tap-to-select accessibility fallback
    card.addEventListener('click', (e) => {
        if (cardLocked || !state.currentQuestion || state.phase !== 'playing') return;
        const dx2 = Math.abs(e.clientX - touchStartX), dy2 = Math.abs(e.clientY - touchStartY);
        if (dx2 > 15 || dy2 > 15) return;
        const rect = card.getBoundingClientRect();
        const tapX = (e.clientX - rect.left) / rect.width;
        const tapY = (e.clientY - rect.top) / rect.height;
        if (tapY < 0.2 && tapX > 0.3 && tapX < 0.7) dismissCard('up');
        else if (tapX < 0.45) dismissCard('left');
        else if (tapX > 0.55) dismissCard('right');
    });
}

function dismissCard(dir) {
    if (cardLocked) return;
    cardLocked = true;
    const card = currentCardEl;
    if (dir === 'left') {
        haptic('medium');
        card.style.transition = 'transform 0.25s ease-in, opacity 0.25s ease-in';
        card.style.transform = 'translateX(-120vw) rotate(-8deg)'; card.style.opacity = '0';
        handleAnswer('A');
    } else if (dir === 'right') {
        haptic('medium');
        card.style.transition = 'transform 0.25s ease-in, opacity 0.25s ease-in';
        card.style.transform = 'translateX(120vw) rotate(8deg)'; card.style.opacity = '0';
        handleAnswer('B');
    } else {
        card.style.transition = 'transform 0.2s ease-in, opacity 0.2s ease-in';
        card.style.transform = 'translateY(-50vh) scale(0.8)'; card.style.opacity = '0';
        handleSkip();
    }
    setTimeout(() => { cardLocked = false; nextCard(); }, 280);
}

/* ============================
   GAME FLOW
   ============================ */

function spawnEmojiReaction(archetype) {
    const a = ARCHETYPES[archetype];
    if (!a) return;
    const stack = document.getElementById('cardStack');
    const rect = stack.getBoundingClientRect();
    for (let i = 0; i < 3; i++) {
        const el = document.createElement('div');
        el.className = 'emoji-reaction';
        el.textContent = a.emoji;
        el.style.left = (rect.left + rect.width * (0.2 + Math.random() * 0.6)) + 'px';
        el.style.top = (rect.top + rect.height * (0.3 + Math.random() * 0.3)) + 'px';
        el.style.animationDelay = (i * 0.12) + 's';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1500);
    }
}

function handleAnswer(choice) {
    const q = state.currentQuestion; if (!q) return;
    const selected = choice === 'A' ? q.optionA.archetype : q.optionB.archetype;
    const other = choice === 'A' ? q.optionB.archetype : q.optionA.archetype;
    state.scores[selected] += 1.0;
    state.scores[other] += 0.25;
    state.questionsAnswered++;
    state.recentChoices.push(selected);
    spawnEmojiReaction(selected);
    updateProgress(false);
}

function handleSkip() {
    const q = state.currentQuestion; if (!q) return;
    state.questionsSkipped++;
    state.skipsPerArchetype[q.optionA.archetype] = (state.skipsPerArchetype[q.optionA.archetype] || 0) + 1;
    state.skipsPerArchetype[q.optionB.archetype] = (state.skipsPerArchetype[q.optionB.archetype] || 0) + 1;
    // No progress update on skip — progress only advances on answered questions
}

function nextCard() {
    if (shouldTerminate()) { updateProgress(true); setTimeout(() => startReveal(), 400); return; }
    const q = selectNextQuestion();
    if (!q) { updateProgress(true); setTimeout(() => startReveal(), 400); return; }
    state.currentQuestion = q;
    state.questionsAsked.add(q.id);
    state.totalAsked++;
    mountCard(createQuestionCard(q), true);
}

function startGame() {
    state.phase = 'tutorial';
    showScreen('game');
    $('#progressArea').classList.add('visible');
    const tutCard = createTutorialCard();
    mountCard(tutCard, true);
    const dismiss = () => {
        state.phase = 'playing';
        cardLocked = true;
        tutCard.style.transition = 'transform 0.25s ease-in, opacity 0.25s ease-in';
        tutCard.style.transform = 'translateY(-30vh) scale(0.9)'; tutCard.style.opacity = '0';
        setTimeout(() => { cardLocked = false; nextCard(); }, 280);
    };
    const tutEnd = (e) => {
        if (!isDragging) return; isDragging = false;
        const t = e.changedTouches ? e.changedTouches[0] : e;
        const dx = t.clientX - touchStartX, dy = t.clientY - touchStartY;
        if (Math.abs(dx) > 50 || dy < -40) dismiss();
        else { tutCard.style.transition = 'transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; tutCard.style.transform = 'translateX(0) rotate(0)'; }
    };
    tutCard.addEventListener('touchend', tutEnd, { passive: true });
    document.addEventListener('mouseup', tutEnd);
    setTimeout(() => { const btn = document.getElementById('tutorialGotIt'); if (btn) btn.addEventListener('click', dismiss); }, 50);
}

/* ============================
   REVEAL
   ============================ */

function startReveal() {
    state.phase = 'reveal';
    state.results = computeResults();
    $('#progressArea').classList.remove('visible');
    showScreen('reveal');
    const r = state.results;
    if (r.mystery) {
        playRevealAnimation('\u2728', 'Mystery Vibe', 'You skipped them all...', "We can't read you \u2014 but that's kind of a flex.", '#FFD60A');
    } else {
        const a = ARCHETYPES[r.primary];
        playRevealAnimation(a.emoji, a.name, `Your hangout is ${a.hangout}`, a.tagline, a.color);
    }
}

function playRevealAnimation(emoji, name, hangout, tagline, color) {
    const container = $('#revealParticles');
    container.innerHTML = '';
    const corners = [
        { x:'0%', y:'0%', c:'#EC4899' }, { x:'100%', y:'0%', c:'#22C55E' },
        { x:'0%', y:'100%', c:'#F97316' }, { x:'100%', y:'100%', c:'#3B82F6' },
    ];
    corners.forEach((corner, i) => {
        for (let j = 0; j < 5; j++) {
            const p = document.createElement('div');
            p.className = 'reveal-particle';
            p.style.cssText = `left:${corner.x};top:${corner.y};width:${20+Math.random()*30}px;height:${20+Math.random()*30}px;background:${corner.c};filter:blur(20px);`;
            container.appendChild(p);
            setTimeout(() => {
                p.style.transition = `all ${0.8+Math.random()*0.4}s cubic-bezier(0.4,0,0.2,1)`;
                p.style.opacity = '0.6'; p.style.left = '50%'; p.style.top = '50%';
                p.style.transform = 'translate(-50%,-50%)';
            }, 500 + i*100 + j*50);
        }
    });
    setTimeout(() => {
        container.innerHTML = '';
        const flash = document.createElement('div');
        flash.style.cssText = `position:absolute;inset:0;background:${color};opacity:0;transition:opacity 0.3s ease;`;
        container.appendChild(flash);
        haptic('heavy');
        requestAnimationFrame(() => { flash.style.opacity = '0.15'; });
        setTimeout(() => { flash.style.opacity = '0'; }, 600);
    }, 2000);
    const emojiEl = $('#revealEmoji'), nameEl = $('#revealName'), hangoutEl = $('#revealHangout'), taglineEl = $('#revealTagline'), btnEl = $('#revealBtn');
    nameEl.style.color = color; nameEl.textContent = ''; emojiEl.textContent = '';
    setTimeout(() => { emojiEl.textContent = emoji; emojiEl.style.opacity = '1'; emojiEl.style.transition = 'opacity 0.4s ease'; }, 2200);
    setTimeout(() => { let idx = 0; nameEl.style.opacity = '1'; const iv = setInterval(() => { nameEl.textContent = name.substring(0, ++idx); if (idx >= name.length) clearInterval(iv); }, 60); }, 2500);
    setTimeout(() => { hangoutEl.textContent = hangout; hangoutEl.style.opacity = '1'; hangoutEl.style.transition = 'opacity 0.5s ease'; }, 3200);
    setTimeout(() => { taglineEl.textContent = `"${tagline}"`; taglineEl.style.opacity = '1'; taglineEl.style.transition = 'opacity 0.5s ease'; }, 3600);
    setTimeout(() => spawnConfetti(color), 2800);
    setTimeout(() => { btnEl.style.opacity = '1'; btnEl.style.transition = 'opacity 0.5s ease'; }, 4000);
}

function spawnConfetti(color) {
    const container = $('#revealParticles');
    const hsl = hexToHSL(color);
    for (let i = 0; i < 40; i++) {
        const p = document.createElement('div');
        p.className = 'confetti-piece';
        p.style.background = `hsl(${hsl.h + (Math.random()-0.5)*40}, ${70+Math.random()*30}%, ${50+Math.random()*30}%)`;
        p.style.left = (30 + Math.random()*40) + '%'; p.style.top = '40%'; p.style.opacity = '0.9';
        p.style.width = (4+Math.random()*6) + 'px'; p.style.height = (6+Math.random()*10) + 'px';
        p.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
        container.appendChild(p);
        const dx = (Math.random()-0.5)*250, dy = -(100+Math.random()*300), rot = (Math.random()-0.5)*720, dur = 1.5+Math.random()*2;
        requestAnimationFrame(() => {
            p.style.transition = `transform ${dur}s cubic-bezier(0.2,0,0.8,1), opacity ${dur}s ease`;
            p.style.transform = `translate(${dx}px,${dy}px) rotate(${rot}deg)`; p.style.opacity = '0';
        });
    }
}

function hexToHSL(hex) {
    let r = parseInt(hex.slice(1,3),16)/255, g = parseInt(hex.slice(3,5),16)/255, b = parseInt(hex.slice(5,7),16)/255;
    const max = Math.max(r,g,b), min = Math.min(r,g,b); let h, s, l = (max+min)/2;
    if (max === min) { h = s = 0; } else {
        const d = max - min; s = l > 0.5 ? d/(2-max-min) : d/(max+min);
        switch (max) { case r: h=((g-b)/d+(g<b?6:0))/6; break; case g: h=((b-r)/d+2)/6; break; case b: h=((r-g)/d+4)/6; break; }
    }
    return { h: Math.round(h*360), s: Math.round(s*100), l: Math.round(l*100) };
}

/* ============================
   RESULTS SCREEN
   ============================ */

function showResults() {
    state.phase = 'results';
    showScreen('results');
    const container = $('#resultsInner');
    const r = state.results;
    const skipRate = state.totalAsked > 0 ? state.questionsSkipped / state.totalAsked : 0;

    if (r.mystery) {
        container.innerHTML = `<div style="text-align:center;padding:40px 0">
            <div style="font-size:64px;margin-bottom:16px">\u2728</div>
            <div style="font-family:'Silkscreen',monospace;font-size:36px;color:var(--accent-primary);margin-bottom:8px">Mystery Vibe</div>
            <p style="color:var(--text-secondary);font-size:15px;line-height:1.4;margin-bottom:24px">You skipped everything \u2014 we can't read you, but that's kind of a flex.</p>
            <button class="btn-primary" onclick="location.reload()">Retake Quiz</button></div>`;
        return;
    }

    const primary = ARCHETYPES[r.primary], secondary = ARCHETYPES[r.secondary];
    const archetypeOrder = ['pulse','glow','cozy','lore'];
    let html = '';

    // Primary + Secondary cards
    html += `<div class="archetype-card" style="--card-color:${primary.color}">
        <div class="archetype-badge primary-badge">Primary Vibe</div>
        <div class="archetype-header"><span class="emoji">${primary.emoji}</span><span class="name" style="color:${primary.color}">${primary.name}</span></div>
        <div class="archetype-desc">${primary.desc}</div></div>`;
    html += `<div class="archetype-card" style="--card-color:${secondary.color}">
        <div class="archetype-badge secondary-badge">Secondary Vibe</div>
        <div class="archetype-header"><span class="emoji">${secondary.emoji}</span><span class="name" style="color:${secondary.color}">${secondary.name}</span></div>
        <div class="archetype-desc">${secondary.desc}</div></div>`;

    // Vibe DNA bars
    html += `<div><div class="section-title">Your Vibe DNA</div><div class="section-subtitle">Your archetype breakdown across all vibes</div><div class="dna-bars">`;
    for (const key of archetypeOrder) {
        const a = ARCHETYPES[key];
        html += `<div class="dna-bar-row"><div class="dna-label"><span>${a.emoji}</span> ${a.name}</div>
            <div class="dna-track"><div class="dna-fill" data-arch="${key}" style="background:${a.color}"></div></div>
            <div class="dna-pct" style="color:${a.color}">${r.affinities[key]}%</div></div>`;
    }
    html += `</div></div>`;

    // Karma + Levels
    html += `<div class="karma-section"><div class="section-title">Karma Earned</div><div class="karma-total">You earned 100 px</div><div class="karma-rows">`;
    for (const key of archetypeOrder) {
        const a = ARCHETYPES[key];
        html += `<div class="karma-row"><span>${a.emoji} ${a.name}</span><span class="amount" style="color:${a.color}">+${r.karma[key]} px</span></div>`;
    }
    html += `</div><div class="karma-bonus">\uD83C\uDF1F Primary Vibe Bonus: +20 px to ${primary.name}</div></div>`;

    // Skip advisory
    if (skipRate > 0.5) {
        html += `<div style="text-align:center;padding:12px 16px;background:rgba(239,68,68,0.1);border-radius:12px;color:#EF4444;font-size:13px">Skip less to get a more accurate vibe next time.</div>`;
    }

    html += `<div class="results-cta"><button class="btn-primary" id="resultsCtaBtn">Show your vibe \u2192</button></div>`;
    container.innerHTML = html;

    // ── Animate DNA bars ──
    setTimeout(() => {
        archetypeOrder.forEach((key, i) => {
            setTimeout(() => {
                const fill = document.querySelector(`.dna-fill[data-arch="${key}"]`);
                if (fill) fill.style.width = r.affinities[key] + '%';
            }, 200 * i);
        });
    }, 300);

    document.getElementById('resultsCtaBtn').addEventListener('click', () => showPromptScreen());
}

/* ============================
   PROFILE PROMPT SCREEN
   ============================ */

function showPromptScreen() {
    state.phase = 'prompt';
    showScreen('prompt-screen');
    const container = $('#promptInner');
    const r = state.results;
    const archetypeOrder = ['pulse','glow','cozy','lore'];

    let hasPhoto = false;
    let hasText = false;
    let selectedPromptKey = null; // "archetype:index"
    let savedText = '';

    // Build all prompts flat for carousel
    function getAllPrompts() {
        const all = [];
        // Primary archetype first
        const order = [r.primary, r.secondary, ...archetypeOrder.filter(k => k !== r.primary && k !== r.secondary)];
        for (const key of order) {
            PROMPTS[key].forEach((p, i) => { all.push({ ...p, archetype: key, key: `${key}:${i}` }); });
        }
        return all;
    }

    function computeBonus() {
        if (hasPhoto && hasText) return 100;
        if (hasPhoto) return 50;
        if (hasText) return 25;
        return 0;
    }

    function render() {
        const allPrompts = getAllPrompts();
        const bonus = computeBonus();
        const selectedP = allPrompts.find(p => p.key === selectedPromptKey);

        let html = `
            <div class="prompt-title">Show your vibe</div>
            <div class="prompt-subtitle">Pick a prompt, then add a photo and caption to show people your vibe.</div>

            <div class="prompt-carousel-wrap">
                <div class="prompt-carousel" id="promptCarousel">`;
        allPrompts.forEach(p => {
            const a = ARCHETYPES[p.archetype];
            html += `<div class="prompt-carousel-card ${p.key === selectedPromptKey ? 'selected' : ''}" data-prompt-key="${p.key}">
                <span style="opacity:0.5;font-size:12px">${a.emoji} ${a.name}</span><br>"${p.text}"</div>`;
        });
        html += `</div></div>`;

        // Response area (photo + text)
        html += `<div class="prompt-response-area ${selectedPromptKey ? 'visible' : ''}" id="promptResponse">`;

        // Photo upload
        html += `<div class="prompt-photo-area ${hasPhoto ? 'has-photo' : ''}" id="photoArea">
            ${hasPhoto
                ? `<div class="photo-done-check">\u2705</div>
                   <div class="photo-label" style="color:var(--accent-primary)">Photo added!</div>
                   <div class="photo-bonus" style="background:rgba(34,197,94,0.15);color:#22C55E">+50 px</div>`
                : `<div style="font-size:36px">\uD83D\uDCF8</div>
                   <div class="photo-label">Add a photo</div>
                   <div class="photo-bonus">+50 px</div>`}
        </div>`;

        // Text answer
        html += `<textarea class="prompt-answer-input" id="promptTextarea" maxlength="150" placeholder="${selectedP ? selectedP.example : 'Your answer...'}">${savedText}</textarea>
            <div class="char-count"><span style="color:${hasText ? 'var(--accent-primary)' : 'var(--text-tertiary)'}">${hasText ? '+25 px' : ''}</span> <span id="charCount">${savedText.length}</span>/150</div>`;

        html += `</div>`;

        // Bonus indicator
        if (bonus > 0) {
            html += `<div class="bonus-summary">\u2728 +${bonus} px bonus</div>`;
        }

        html += `<div class="prompt-actions">
            <button class="btn-primary" id="promptSaveBtn" style="${selectedPromptKey && (hasPhoto || hasText) ? '' : 'opacity:0.4;pointer-events:none'}">Save & Continue</button>
            <button class="btn-ghost" id="promptSkipBtn">I'll do this later</button></div>`;

        container.innerHTML = html;

        // ── Event handlers ──
        // Carousel prompt selection
        container.querySelectorAll('.prompt-carousel-card').forEach(card => {
            card.addEventListener('click', () => {
                selectedPromptKey = card.dataset.promptKey;
                render();
                haptic('light');
            });
        });

        // Photo area tap
        const photoArea = document.getElementById('photoArea');
        if (photoArea) {
            photoArea.addEventListener('click', () => {
                if (!hasPhoto) { hasPhoto = true; render(); haptic('medium'); }
            });
        }

        // Text input
        setTimeout(() => {
            const ta = document.getElementById('promptTextarea');
            if (ta) {
                ta.addEventListener('input', () => {
                    savedText = ta.value;
                    const hadText = hasText;
                    hasText = ta.value.trim().length > 0;
                    document.getElementById('charCount').textContent = ta.value.length;
                    if (hasText !== hadText) render();
                });
            }
        }, 50);

        // Save / Skip
        document.getElementById('promptSaveBtn').addEventListener('click', () => {
            state.promptBonus = computeBonus();
            state.promptData = selectedP ? { prompt: selectedP.text, hasPhoto, text: savedText } : null;
            showDone();
        });
        document.getElementById('promptSkipBtn').addEventListener('click', () => {
            state.promptBonus = 0;
            state.promptData = null;
            showDone();
        });
    }

    render();
}

/* ============================
   DONE SCREEN
   ============================ */

function showDone() {
    state.phase = 'done';
    showScreen('done-screen');
    const r = state.results;
    const arch = r.mystery ? null : ARCHETYPES[r.primary];
    const container = $('#doneContent');
    const archetypeOrder = ['pulse','glow','cozy','lore'];

    // For prototype: always show the cookie card
    const donePrompt = 'The meal I\u2019d cook to impress you';
    const doneText = 'Cookies can be a meal right?';
    const doneBonus = 100; // photo + caption
    state.promptBonus = doneBonus;
    const totalPx = 100 + doneBonus;

    let html = `
        <div class="done-title">You're all set!</div>
        <div class="done-subtitle">${arch ? arch.hangoutIntro : "Your vibe is a mystery \u2014 and that's kind of cool."}</div>

        <div class="done-prompt-card">
            <img class="done-prompt-img" src="./assets/images/ginger_molasses_cookies.jpg" alt="Ginger molasses cookies">
            <div class="done-prompt-body">
                <div class="done-prompt-label">${donePrompt}</div>
                <div class="done-prompt-text">${doneText}</div>
                <div class="done-prompt-bonus">\uD83D\uDCF8 +${doneBonus} px for photo + caption</div>
            </div>
        </div>

        <div class="done-bonus-total">\u2728 ${totalPx} px earned total</div>`;

    // Karma breakdown
    html += `<div class="karma-section" style="width:100%"><div class="section-title">Your Karma</div>
        <div class="karma-rows">`;
    for (const key of archetypeOrder) {
        const a = ARCHETYPES[key];
        const archKarma = r.karma[key] + (key === r.primary ? doneBonus : 0);
        html += `<div class="karma-row"><span>${a.emoji} ${a.name}</span><span class="amount" style="color:${a.color}">${archKarma} px</span></div>`;
    }
    html += `</div></div>`;

    html += `<button class="btn-primary" style="margin-top:8px;width:100%" onclick="location.reload()">Explore Your Hangout</button>`;

    container.innerHTML = html;
}

/* ============================
   INIT
   ============================ */

localStorage.removeItem('vibeCheckState');
$('#startBtn').addEventListener('click', startGame);
$('#revealBtn').addEventListener('click', showResults);

// Periodic state save during game
setInterval(() => {
    if (state.phase === 'playing') {
        localStorage.setItem('vibeCheckState', JSON.stringify({
            scores: state.scores, questionsAsked: Array.from(state.questionsAsked),
            questionsAnswered: state.questionsAnswered, questionsSkipped: state.questionsSkipped,
            totalAsked: state.totalAsked, displayedProgress: state.displayedProgress,
        }));
    }
}, 2000);

</script>
</body>
</html>
